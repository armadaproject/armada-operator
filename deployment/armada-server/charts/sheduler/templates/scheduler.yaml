apiVersion: install.armadaproject.io/v1alpha1
kind: Scheduler
metadata:
  name: {{ include "armada.name" . }}
  namespace: {{ .Release.Namespace }}
  labels:
{{- include "armada.labels" . | nindent 4 }}
spec:
  hostNames: {{ .Values.hostNames }}
  ingress:
    ingressClass: {{ .Values.ingressClass | default .Values.global.ingressClass }}
  clusterIssuer: {{ .Values.custerIssuer | default .Values.global.clusterIssuer }}
  replicas: {{ .Values.replicas }}
  resources:
    limits:
      memory: {{ .Values.resources.limits.memory }}
      cpu: {{ .Values.resources.limits.cpu }}
    requests:
      memory: {{ .Values.resources.requests.memory }}
      cpu: {{ .Values.resources.requests.cpu }}
  environment:
    - name: LOG_FORMAT
      value: {{ .Values.environment.LOG_FORMAT }}
    - name: ARMADA_LEADER_PODNAME
      valueFrom:
        fieldRef:
          fieldPath: metadata.name
    - name: ARMADA_LEADER_LEASELOCKNAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
  prometheus:
    enabled: {{ .Values.prometheus.enabled }}
    scrapeInterval: {{ .Values.prometheus.scrapeInterval }}
  prunerConfig:
    daysToKeep: {{ .Values.prunerConfig.daysToKeep }}
    batchSize: {{ .Values.prunerConfig.batchSize }}
  image:
    repository: {{ .Values.image.repository }}
    tag: {{ .Values.image.tag | default .Values.global.image.tag}}
  applicationConfig:
{{ tpl (.Files.Get "application-config.yaml") . | indent 4 }}

